{
  "version": 3,
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["/turbopack/[turbopack-node]/transforms/webpack-loaders.ts"],"sourcesContent":["declare const __turbopack_external_require__: {\n  resolve: (name: string, opt: { paths: string[] }) => string;\n} & ((id: string) => any);\n\nimport type { Ipc } from \"../ipc/evaluate\";\nimport {\n  relative,\n  isAbsolute,\n  sep,\n  dirname,\n  resolve as pathResolve,\n} from \"path\";\nimport {\n  StackFrame,\n  parse as parseStackTrace,\n} from \"../compiled/stacktrace-parser\";\n\ntype LoaderConfig =\n  | string\n  | {\n      loader: string;\n      options: { [k: string]: unknown };\n    };\n\nlet runLoaders: typeof import(\"loader-runner\")[\"runLoaders\"];\ntry {\n  ({ runLoaders } = require(\"@vercel/turbopack/loader-runner\"));\n} catch {\n  ({ runLoaders } = __turbopack_external_require__(\"loader-runner\"));\n}\n\nconst contextDir = process.cwd();\nconst toPath = (file: string) => {\n  const relPath = relative(contextDir, file);\n  if (isAbsolute(relPath)) {\n    throw new Error(\n      `Cannot depend on path (${file}) outside of root directory (${contextDir})`\n    );\n  }\n  return sep !== \"/\" ? relPath.replaceAll(sep, \"/\") : relPath;\n};\n\nconst LogType = Object.freeze({\n  error: \"error\",\n  warn: \"warn\",\n  info: \"info\",\n  log: \"log\",\n  debug: \"debug\",\n\n  trace: \"trace\",\n\n  group: \"group\",\n  groupCollapsed: \"groupCollapsed\",\n  groupEnd: \"groupEnd\",\n\n  profile: \"profile\",\n  profileEnd: \"profileEnd\",\n\n  time: \"time\",\n\n  clear: \"clear\",\n  status: \"status\",\n});\n\nconst loaderFlag = \"LOADER_EXECUTION\";\n\nconst cutOffByFlag = (stack: string, flag: string): string => {\n  const errorStack = stack.split(\"\\n\");\n  for (let i = 0; i < errorStack.length; i++) {\n    if (errorStack[i].includes(flag)) {\n      errorStack.length = i;\n    }\n  }\n  return errorStack.join(\"\\n\");\n};\n\n/**\n * @param stack stack trace\n * @returns stack trace without the loader execution flag included\n */\nconst cutOffLoaderExecution = (stack: string): string =>\n  cutOffByFlag(stack, loaderFlag);\n\nclass DummySpan {\n  traceChild() {\n    return new DummySpan();\n  }\n\n  traceFn<T>(fn: (span: DummySpan) => T): T {\n    return fn(this);\n  }\n\n  async traceAsyncFn<T>(fn: (span: DummySpan) => T | Promise<T>): Promise<T> {\n    return await fn(this);\n  }\n}\n\nconst transform = (\n  ipc: Ipc,\n  content: string,\n  name: string,\n  loaders: LoaderConfig[]\n) => {\n  return new Promise((resolve, reject) => {\n    const resource = pathResolve(contextDir, name);\n    const resourceDir = dirname(resource);\n\n    const loadersWithOptions = loaders.map((loader) =>\n      typeof loader === \"string\" ? { loader, options: {} } : loader\n    );\n\n    runLoaders(\n      {\n        resource,\n        context: {\n          currentTraceSpan: new DummySpan(),\n          rootContext: contextDir,\n          getOptions() {\n            const entry = this.loaders[this.loaderIndex];\n            return entry.options && typeof entry.options === \"object\"\n              ? entry.options\n              : {};\n          },\n          getResolve: () => ({\n            // [TODO] this is incomplete\n          }),\n          emitWarning: makeErrorEmitter(\"warning\", ipc),\n          emitError: makeErrorEmitter(\"error\", ipc),\n          getLogger(name: unknown) {\n            return (type: unknown, args: unknown) => {\n              let trace;\n              switch (type) {\n                case LogType.warn:\n                case LogType.error:\n                case LogType.trace:\n                  trace = cutOffLoaderExecution(new Error(\"Trace\").stack!)\n                    .split(\"\\n\")\n                    .slice(3);\n                  break;\n              }\n              const logEntry = {\n                time: Date.now(),\n                type,\n                args,\n                trace,\n              };\n\n              this.hooks.log.call(name, logEntry);\n            };\n          },\n        },\n\n        loaders: loadersWithOptions.map((loader) => ({\n          loader: __turbopack_external_require__.resolve(loader.loader, {\n            paths: [resourceDir],\n          }),\n          options: loader.options,\n        })),\n        readResource: (_filename, callback) => {\n          // TODO assuming the filename === resource, but loaders might change that\n          callback(null, Buffer.from(content, \"utf-8\"));\n        },\n      },\n      (err, result) => {\n        if (err) return reject(err);\n        for (const dep of result.contextDependencies) {\n          ipc.send({\n            type: \"dirDependency\",\n            path: toPath(dep),\n            glob: \"**\",\n          });\n        }\n        for (const dep of result.fileDependencies) {\n          ipc.send({\n            type: \"fileDependency\",\n            path: toPath(dep),\n          });\n        }\n        if (!result.result) return reject(new Error(\"No result from loaders\"));\n        const [source, map] = result.result;\n        resolve({ source, map });\n      }\n    );\n  });\n};\n\nexport { transform as default };\n\nfunction makeErrorEmitter(severity: \"warning\" | \"error\", ipc: Ipc) {\n  return function (error: Error | string) {\n    ipc.send({\n      type: \"emittedError\",\n      severity: severity,\n      error:\n        error instanceof Error\n          ? {\n              name: error.name,\n              message: error.message,\n              stack: parseStackTrace(error.stack),\n            }\n          : {\n              name: \"Error\",\n              message: error,\n              stack: [],\n            },\n    });\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}